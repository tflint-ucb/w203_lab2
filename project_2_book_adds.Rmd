---
title: 'Lab 2: What Makes a Movie Successful? Fall 2021'
author: 'w203: Statistics for Data Science'
date: "November 1, 2021"
output:
  pdf_document: default
  html_document: default
---

```{r, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE)

library(tidyverse)
library(ggplot2) 
library(jsonlite)

library(sandwich)
library(stargazer)
library(gridExtra)
library(stringr)
library(lmtest)
library(knitr)
```

## Introduction

What makes a movie “one of the greats”? While that question may elude both data analysts and artists for years to come, we are looking to  find some effective indicators of box office success for films, in the hopes of maintaining a thriving movie industry for years to come. This project will focus on several commonly cited reasons for movie fiscal success and analyze how much of an impact each factor has. 

The client for this analysis could be any major movie studio or its parent company, e.g. NBCUniversal or Walt Disney Studios. This is a significant issue, because box office sales decreased by 60% in 2020 during COVID-19 pandemic, leaving the movie theaters empty for months. This analysis will provide clues for what a studio can do to speed up the recovery and account for lost revenue.

The main dataset we’ll use for this analysis comes from The Movie Database (TMDB - https://www.themoviedb.org/), as well as several assembled lists from online polls (e.g. “Greatest Actors/Actresses of All Time” - Ranker.com).

We’re planning on using profitability as the response variable for analysis in this study - using R to clean the empty and irrelevant cells, a “profitability ratio” can be determined for each movie based on its box office sales divided by budget (and controlling for foreign films and currencies).

In order to build our models, we decided to focus on some factors that are usually linked to a movie's financial success, such as budget, time of release, its cast's popularity and director's name brand recognition. We will also take into account some control variables such as runtime and genre.


The products of this analysis will include the code and final datasets, as well as a written summary of the significant results. 


## Data, Research Question, Underlying Model and Study Design

### Data
As mentioned before our main dataset comes from data extracted from The Movie Database (TMDB - https://www.themoviedb.org/). This dataset was compiled by Kaggle for a Machine Learning competition a few years ago.

The original dataset consists of 22 variables for over 7000 films, from the 1920s to 2017. This dataset consists of objective data for each of these movies such as budget, revenue, cast, crew, release date, production company, original language among others.

We also added two more datasets consisting of two lists with a ranking of the "Top 100 movie actors of all time", as well as the top "Top 50 directors". Unlike the previous dataset, these ranks is subjective, but we plan on using these lists to help us create a variable that could stand in for an actor's or director's popularity.

We performed some data cleaning operations on the main dataset in order to have it be ready for our analysis. These included:

- Eliminating any entries that had some vital information missing (such as revenue, budget, cast, crew and genres)
- Parsing certain fields from a stringified JSON.
- Creating the "Actors" column from the "Cast" column
- Extracting the Director from the "Crew" column

After completing this process we still had over 2000 entries.


```{r, include=FALSE}
d <- read.csv('./src/data/Clean_Data_set.csv')

inflation_df <- read.csv('./src/data/CPIAUCNS.csv')

actors_df <- read.csv('./src/data/Greatest Actors List.csv')

directors_df <- read.csv('./src/data/Greatest Directors List.csv')
```


```{r, include=FALSE}
# exclude unnecessary variables
excluded_variables <- names(d) %in% c("homepage", "overview", "imdb_id", "popularity", "poster_path", "status", "tagline", "title", "Keywords", "production_companies", "production_countries", "spoken_languages", "cast", "crew")
short_data <- d[!excluded_variables]

#remove empty actors entry
actors_df<- actors_df[(actors_df$Name != ''),]

#rename director columns
names(directors_df)[names(directors_df) == 'Name'] <- 'director_name'
names(directors_df)[names(directors_df) == 'Score'] <- 'director_score'
names(short_data)[names(short_data) == 'directors'] <- 'director_name'

#drop unnecessary director columns
excluded_variables <- names(directors_df) %in% c("Rank", "Count", "M.or.F")
directors_df <- directors_df[!excluded_variables]
```


```{r clean data, include=FALSE}
# Remove entries without budget revenue or genre or actors
clean_data<-short_data[(short_data$budget > 0),]
clean_data<-clean_data[(clean_data$runtime > 0),]
clean_data<-clean_data[(clean_data$actors != "[]"),]
clean_data<-clean_data[!(is.na(clean_data$revenue)),]

# Convert belongs_to_collection to a True or False variable
clean_data$belongs_to_collection[clean_data$belongs_to_collection != ""] <- TRUE
clean_data$belongs_to_collection[clean_data$belongs_to_collection == ""] <- FALSE

```


```{r add actor score, include=FALSE}
top_actors <- actors_df$Name
count_top_actors <- function(list) {
  counter <- 0
  for (actor in top_actors) {
    if (regexpr(actor, list[11]) >= 0) {
      counter <- counter + 1
    }
  }
  return(counter)
}

clean_data$actor_score <- apply(clean_data, 1, FUN = count_top_actors)
```


```{r add director score, include=FALSE}
merged_data <- merge(clean_data, directors_df, by = "director_name", all.x = TRUE)

merged_data$director_score[is.na(merged_data$director_score)] <- 0
```

```{r add month of release and format date, include=FALSE}
get_month <- function(list) {
  date <- list[8]
  month <- str_extract(date, "[^/]+")
  return (as.numeric(month))
}

merged_data$month_of_release <- apply(merged_data, 1, FUN = get_month)
```

```{r adjust by inflation, include=FALSE}

merged_data$formatted_release_date <- as.Date(merged_data$release_date,
  format = "%m/%d/%y")

merged_data <- merged_data %>% 
  mutate(formatted_release_date = str_replace(formatted_release_date, "[^-]+$", "01"))

merged_data <- merge(merged_data, inflation_df, by.x = "formatted_release_date", by.y= "DATE", all.x = TRUE)

merged_data <- merged_data %>% 
  mutate(
    formatted_release_date = case_when(
      is.na(CPIAUCNS) ~ str_replace(formatted_release_date, "20", "19"),
      !(is.na(CPIAUCNS)) ~ formatted_release_date,
    )
  )

merged_data = subset(merged_data, select = -c(CPIAUCNS) )

merged_data <- merge(merged_data, inflation_df, by.x = "formatted_release_date", by.y= "DATE", all.x = TRUE)

merged_data <- merged_data %>% 
  mutate(
    budget = budget * 100 / CPIAUCNS,
    revenue = revenue * 100 / CPIAUCNS,
  )

```

```{r, include=FALSE}
final_table <- merged_data %>% 
  mutate(
    comedy = case_when(
      #encode comedy, and all subsequent genres as binary
      regexpr('Comedy', genres) >= 0 ~ 1, 
      regexpr('Comedy', genres) == -1 ~ 0),
    
    drama = case_when(
      regexpr('Drama', genres) >= 0 ~ 1, 
      regexpr('Drama', genres) == -1 ~ 0),

    family = case_when(
      regexpr('Family', genres) >= 0 ~ 1, 
      regexpr('Family', genres) == -1 ~ 0),

    romance = case_when(
      regexpr('Romance', genres) >= 0 ~ 1, 
      regexpr('Romance', genres) == -1 ~ 0), 
    
    thriller = case_when(
      regexpr('Thriller', genres) >= 0 ~ 1, 
      regexpr('Thriller', genres) == -1 ~ 0), 
    
    animation = case_when(
      regexpr('Animation', genres) >= 0 ~ 1, 
      regexpr('Animation', genres) == -1 ~ 0), 
    
    adventure = case_when(
      regexpr('Adventure', genres) >= 0 ~ 1, 
      regexpr('Adventure', genres) == -1 ~ 0), 
    
    horror = case_when(
      regexpr('Horror', genres) >= 0 ~ 1, 
      regexpr('Horror', genres) == -1 ~ 0), 
    
    music = case_when(
      regexpr('Music', genres) >= 0 ~ 1, 
      regexpr('Music', genres) == -1 ~ 0), 
    
    crime = case_when(
      regexpr('Crime', genres) >= 0 ~ 1, 
      regexpr('Crime', genres) == -1 ~ 0), 
    
    sci_fi = case_when(
      regexpr('Science Fiction', genres) >= 0 ~ 1, 
      regexpr('Science Fiction', genres) == -1 ~ 0), 
    
    action = case_when(
      regexpr('Action', genres) >= 0 ~ 1, 
      regexpr('Action', genres) == -1 ~ 0), 
    
    war = case_when(
      regexpr('War', genres) >= 0 ~ 1, 
      regexpr('War', genres) == -1 ~ 0), 
    
    western = case_when(
      regexpr('Western', genres) >= 0 ~ 1, 
      regexpr('Western', genres) == -1 ~ 0), 
    
    fantasy = case_when(
      regexpr('Fantasy', genres) >= 0 ~ 1, 
      regexpr('Fantasy', genres) == -1 ~ 0), 
    
    foreign = case_when(
      regexpr('Foreign', genres) >= 0 ~ 1, 
      regexpr('Foreign', genres) == -1 ~ 0), 
        
    mystery = case_when(
      regexpr('Mystery', genres) >= 0 ~ 1, 
      regexpr('Mystery', genres) == -1 ~ 0), 
    
    history = case_when(
      regexpr('History', genres) >= 0 ~ 1, 
      regexpr('History', genres) == -1 ~ 0), 
    
    documentary = case_when(
      regexpr('Documentary', genres) >= 0 ~ 1, 
      regexpr('Documentary', genres) == -1 ~ 0),
    
    january = case_when(
      
      substr(release_date, start = 1, stop = 2) == '1/' ~ 1, 
      substr(release_date, start = 1, stop = 2) != '1/' ~ 0),
    
    
     february = case_when(
      substr(release_date, start = 1, stop = 2) == '2/' ~ 1, 
      substr(release_date, start = 1, stop = 2) != '2/' ~ 0),
    
    march = case_when(
      
      substr(release_date, start = 1, stop = 2) == '3/' ~ 1, 
      substr(release_date, start = 1, stop = 2) != '3/' ~ 0),
    
    april = case_when(
      
      substr(release_date, start = 1, stop = 2) == '4/' ~ 1, 
      substr(release_date, start = 1, stop = 2) != '4/' ~ 0),
    
    may = case_when(
      
      substr(release_date, start = 1, stop = 2) == '5/' ~ 1, 
      substr(release_date, start = 1, stop = 2) != '5/' ~ 0),
       
     june = case_when(
      
      substr(release_date, start = 1, stop = 2) == '6/' ~ 1, 
      substr(release_date, start = 1, stop = 2) != '6/' ~ 0),
    
    july = case_when(
      
      substr(release_date, start = 1, stop = 2) == '7/' ~ 1, 
      substr(release_date, start = 1, stop = 2) != '7/' ~ 0),
    
    
    august = case_when(
      
      substr(release_date, start = 1, stop = 2) == '8/' ~ 1, 
      substr(release_date, start = 1, stop = 2) != '8/' ~ 0),
    
    september = case_when(
      
      substr(release_date, start = 1, stop = 2) == '9/' ~ 1, 
      substr(release_date, start = 1, stop = 2) != '9/' ~ 0),
    
    october = case_when(
      
      substr(release_date, start = 1, stop = 2) == '10' ~ 1, 
      substr(release_date, start = 1, stop = 2) != '10' ~ 0),
    
    november = case_when(
      
      substr(release_date, start = 1, stop = 2) == '11' ~ 1, 
      substr(release_date, start = 1, stop = 2) != '11' ~ 0),
    
    december = case_when(
      
      substr(release_date, start = 1, stop = 2) == '12' ~ 1, 
      substr(release_date, start = 1, stop = 2) != '12' ~ 0),
    
    native_english_film = case_when(
      
      original_language == 'en' ~ 1, 
      original_language != 'en' ~ 0), 
    
    profitability_ratio = revenue / budget
    
    
  )


```

### Research Question

This study intends to find significant relationships between factors known before a movie release and its box office success. We will look at both its relative box office (in USD) as the way of measuring a movie's success.

The results of this study could be used by film makers to better inform their investment decisions.

### Study Design

We will use the gathered data to answer our research question by finding possible causal relationships between our selected variables and a movie's box office revenue.

We will first conduct an exploratory data analysis on each of our variables, as well as commonly cited relationships, in order to decide which variables could potentially have a causal relationship with a movie's revenue.

Since we are trying to find causal relationships we will focus solely on factors that could be known or decided on before a movie is released, so variables like Rotten Tomatoes rating, word of mouth, or awards will not be considered.

### Underlying Model

As mentioned in the introduction, we plan on using commonly cited reasons for movie's financial success to create our models, starting with a simplified model with just the key variables, and then add more variables we hypothesize could have an effect on a movie's financial success to the following models

#### Our outcome variable - Revenue

Given our research question, having revenue be our outcome variable was a natural choice. We considered using profitability ratio, as that would allow us to skip some necessary adjustments (Mainly inflation), however we realized that interpreting the results for profitability ratio made it more complicated than it needed to be.

As mentioned before, if we were to use revenue, we would need to account for inflation. Our dataset goes back almost 100 years, which means that the box office of a movie in the 1920s would be compared to a box office in the 2010s. This would skew our results towards more modern films, which would, all things equal, have a higher box office just because of inflation.

We decided to use the Consumer Price Index for All Urban Consumers: All Items in U.S. City Average (CPIAUCNS) from the Federal Reserve Economic Data website. It uses the years 1982 to 1984 as their base.

We applied this index to both our budget and revenue since those are the only variables that are in USD.

#### Simplified model

The most simple and straight forward way of predicting a movie's box office would be its budget. The relationship is pretty clear. The more money that is put into a project the better it is expected to do. One would also expect the increase budget would go into improving the quality of the movie that in turn should increase its box office performance.

```{r echo=FALSE}

p1 <- ggplot(final_table, aes(x=budget/1000000, y=revenue/1000000)) + geom_point() + labs(
  title = 'Movie Revenue over Budget',
  x = "Budget in MM USD",
  y = "Revenue in MM USD"
)

p2 <- ggplot(final_table, aes(x=log(budget), y=log(revenue))) + geom_point() + labs(
  title = 'Log Movie Revenue over Budget',
  x = "Log of. Budget in USD",
  y = "Log of Revenue in USD"
)

grid.arrange(p1, p2, nrow = 1)

```

As seen in the previous charts, there is a clear positive relationship between budget and revenue, both for with and without a logarithmic transformation. This contributes to our hypothesis than a higher budget leads to a better box office.

#### Seasonality

Just like for a lot of other industries, seasonality in the movie industry is a well documented phenomena. ^[Einav, L. (2007). Seasonality in the U.S. Motion Picture Industry. The RAND Journal of Economics, 38(1), 127–145. http://www.jstor.org/stable/25046296]

Certain times of the year tend to attract more moviegoers, such as the summer, the holiday season and certain weekends that coincide with important holidays (Christmas, 4th of July weekend, Memorial Day weekend, among others). This increase demand would lead to a better box office performance.

On the other hand, supply is also affected by seasonality. Big budget movies are more likely to be released during a time of the year that could help them maximize their potential revenue. 

This self-selection on the supply side is likely to have an effect on the demand as well, as a greater number of quality movies during certain times would attract more movie goers.

Our model will control for this effect by adding the month of release to the model. We would expect the summer months, as well as December to have a significant positive effect on revenue.

If we just look at the distribution, we'll notice that more movies come out in the fall, however if we instead look at the average revenue per month, we see a peak during the summer, and a smaller peak towards the end of the year.

```{r echo=FALSE}

p1 <- ggplot(final_table, aes(x=factor(month_of_release))) + geom_bar() + ggtitle("Distribution of Month of Release Date") + xlab("Month") + ylab("Count")

p2 <- ggplot(final_table, aes(x=factor(month_of_release), y=revenue/1000000)) +  
       stat_summary(fun = mean, geom="bar", size = 1)  + ggtitle("Average Revenue (MM USD) by Month of Release Date") + xlab("Month") + ylab("Revenue")

grid.arrange(p1, p2, nrow = 2)
```

#### The Cast and Director's Name Recognition

It shouldn't be a surprise to anyone that famous actors attract crowds, which in turn increase the movie's box office performance. Audiences want to see their favorite actors in their movies, for a variety of reasons.

A recent example that comes to mind is the 2021 movie adaptation of Dune. The actress Zendaya was a big part of the movie's marketing, despite the fact that she only briefly appears in the movie. A lot of movie goers were upset after seeing the movie because they expected her to have a bigger role.^[https://nypost.com/2021/10/26/fans-outraged-that-zendaya-is-in-dune-for-only-7-minutes/].

For our model we will give each movie an "Actor Score" which will be just a counter of how many well known actors are part of their cast.

We have also added a "Director Score" which will reflect a movie's director ranking in the following manner:

- Top 10 - 5 points
- Top 20 - 4 points
- Top 30 - 3 points
- Top 40 - 2 points
- Top 50 - 1 point
- Not on the ranking - 0 points

Our initial exploratory data analysis showed us that the vast majority of movies in our dataset were not made by a "Top Director", however, once we look at the average revenue by director score we notice an interesting shape.

Having a "Top Director" does seem to have a higher average revenue, but what's quite interesting is that the highest revenue is found with the "mid-tier" Top Directors. One explanation could be that the "Best Directors" do not always do films that appeal to mainstream audiences, while the ones towards the middle of the list are both great directors and direct movies that appeal to a wider audience.

A similar thing happens when we look at the "Actor score" variable. Movies with "Top Actors" tend to have a higher average revenue, with this maxing out at 5 "top actors".

```{r echo=FALSE}

p1 <- ggplot(final_table, aes(x=factor(director_score))) + geom_bar() + ggtitle("Distribution of Director Score") + xlab("Director Score") + ylab("Count")

p2 <- ggplot(final_table, aes(x=factor(director_score), y=revenue/1000000)) +  
       stat_summary(fun = mean, geom="bar", size = 1)  + ggtitle("Average Revenue (MM USD) vs Director Score") + xlab("Director Score") + ylab("Revenue")

p3 <- ggplot(final_table, aes(x=factor(actor_score))) + geom_bar() + ggtitle("Distribution of Actor Score") + xlab("Actor Score") + ylab("Count")

p4 <- ggplot(final_table, aes(x=factor(actor_score), y=revenue/1000000)) +  
       stat_summary(fun = mean, geom="bar", size = 1)  + ggtitle("Average Revenue (MM USD) vs Actor Score") + xlab("Actor Score") + ylab("Revenue")

grid.arrange(p1, p2, p3, p4, nrow = 2)
```

#### Genre

There are a lot of different movie genres, and a movie can be considered to have multiple of those. We do not have very specific expectations regarding which genres may have a significant effect on revenue.

#### Is it part of a franchise/collection?

There have always been movies that have been part of something bigger. Successful movies tend to spawn sequels, or even entire series. Just being associated with something greater may help a movie do better in the box office.

An initial EDA shows that movies that belong to a collection have a significantly higher average revenue.

```{r echo=FALSE}

ggplot(final_table, aes(x=belongs_to_collection, y=revenue/1000000)) +  
       stat_summary(fun = mean, geom="bar", size = 1)  + ggtitle("Average Revenue (MM USD) vs Being part of a Franchise") + xlab("Part of a collection?") + ylab("Revenue")
```

#### Where is the movie from?

The global box office is not evenly distributed. While this uneveness has decreased over the years, the American audience still makes up the biggest chunk of the global box office.

Because of this we decided to add a dummy variable that uses a movie's original language. If the movie's original language is in English, then it will have a value of 1, and if it isn't, then 0.

Our initial EDA shows us that there is indeed a clear difference between movies with english as their original language and those that have another language.

```{r echo=FALSE}

ggplot(final_table, aes(x=native_english_film, y=revenue/1000000)) +  
       stat_summary(fun = mean, geom="bar", size = 1)  + ggtitle("Average Revenue (MM USD) vs Is the movie in English?") + xlab("Is the movie in English?") + ylab("Revenue")
```

#### How long is the movie?

The final covariate that we are considering adding to the movie is runtime. As seen in the distribution chart, most movies tend to be around the 100 minute mark.

If we look at the relationship between log of revenue and runtime, we'll notice that movies with a longer runtime tend to be more grouped together, and their average revenue seems to be higher. While movies closer to the 100 minute mark have a wider range of revenue.


```{r echo=FALSE}

p1 <- ggplot(final_table, aes(x=runtime)) + geom_histogram(bins = 100) + ggtitle("Distribution of Film Runtime") + xlab("Runtime (min)") + ylab("Count")
#runtime appears to be relatively normally distributed overall, except for the narrow group on the lower end of time

p2 <- ggplot(final_table, aes(x=runtime, y=log(revenue))) + geom_point() + ggtitle("Log of Revenue vs Film Runtime") + xlab("Runtime (min)") + ylab("Revenue")
#runtime appears to be relatively normally distributed overall, except for the narrow group on the lower end of time

grid.arrange(p1, p2, nrow = 2)
```

## Statistical Model

We're looking to see which model and variables will be a good approximation for future films' natural logarithm of revenue(in U.S. dollars). We will be building 4 predictive models to help assess our research question of which variables play a more significant role in box office revenues to help the industry recover from the decline in the last year. We start with a simple model with just the `budget` variable. 

In the Log Revenue over Budget graph earlier in the report we can see a relationship between budget and film success measured in revenue. For the 2 following models we add covariates to control for additional variables that we expect to be significant. And the final 4th model will include only the variables that proved to be statistically and practically significant.

Variable that we're most interested in is budget $\beta_1$, which measures a percent increase or decrease in revenue for every 1% increase in budget. We applied a natural logarithm transformation to both variables because the distribution was skewed towards lower variables(shown in the graph below). The transformation spread out the values, and the results show that the original data has a more log-normal distribution, making this transformation a good choice to improve our model.

```{r echo=FALSE}

p1 <- ggplot(final_table, aes(x=budget)) + geom_histogram(bins = 100) + ggtitle("Distribution of Film Budgets") + xlab("Budget (USD)") + ylab("Count")

p2 <- ggplot(final_table, aes(x=revenue)) + geom_histogram(bins = 100)  + ggtitle("Distribution of Film Revenues") + xlab("Revenue (USD)") + ylab("Count")


# The logarithm of both budget and revenue appear more homogenously distributed
p3 <- ggplot(final_table, aes(x=log(budget))) + geom_histogram(bins = 100) + ggtitle("Distribution of Log of Film Budgets") + xlab("Log of Budget (USD)") + ylab("Count")

p4 <- ggplot(final_table, aes(x=log(revenue))) + geom_histogram(bins = 100) + ggtitle("Distribution of Log of Film Revenues") + xlab("Log of Revenue (USD)") + ylab("Count")

grid.arrange(p1, p2, p3, p4, nrow = 2)

```

Two of the covariates that we will be adding are movie genre and release month that will have multiple categories within each variable. Since we will be assessing multiple t-test results we may want to account for p-values that may show significance only because we have numerous categories that we're testing against. We will be multiplying the p-value by the number of genres or months in the model.

1) Model 1: Natural logarithm of revenue on a constant and natural logarithm of budget

$$
  log(\text{revenue}) = \beta_0 + \beta_1 log(\text{budget})
$$ 

2) Model 2: Natural logarithm of revenue on a constant, natural logarithm of budget and genre

$$
  log(\text{revenue}) = \beta_0 + \beta_1 log(\text{budget}) + \beta_2 \text{genre}
$$

3) Model 3: Natural logarithm of revenue on a constant, natural logarithm of budget, genre, runtime, actor_score, director_score,release month, indicator variable of native english film and belongs to a collection(if the film is part of a sequel)

$$
  log(\text{revenue}) = \beta_0 + \beta_1 log(\text{budget}) + \beta_2 \text{genre}
  + \beta_3 \text{runtime} + \beta_4 \text{actor score} + \beta_5 \text{director score}
  + \beta_6 \text{native english film} + \beta_7 \text{release month} 
  + \beta_8 \text{belongs to collecion}
$$

4) Model 4: Natural logarithm of revenue on a constant, natural logarithm of budget, significant genre, runtime, actor_score, director_score, significant release month, indicator variable of native english film and belongs to a collection(if the film is part of a sequel)

$$
  log(\text{revenue}) = \beta_0 + \beta_1 log(\text{budget}) + \beta_2 \text{genre}_s
  + \beta_3 \text{runtime} + \beta_4 \text{actor score} + \beta_5 \text{director score}
  + \beta_6 \text{native english film} + \beta_7 \text{release month}_s 
  + \beta_8 \text{belongs to collecion}
$$

* The subscript `s` for significant variables

```{r, include=FALSE}

source('./src/get_robust_se.R')

#Model for Pure Revenue 
model_1 <- lm(log(revenue) ~ log(budget), data=final_table)

#Model for Pure Revenue and Genre
model_2 <- lm(log(revenue) ~ log(budget) + comedy + drama + family + romance + thriller + animation + adventure + horror + music + crime + sci_fi + action + war + western + fantasy + foreign + mystery + history + documentary, data=final_table)

#Model for Pure Revenue and all other variables
model_3 <- lm(log(revenue) ~ log(budget) + comedy + drama + family + romance + thriller + animation + adventure + horror + music + crime + sci_fi + action + war + western + fantasy + foreign + mystery + history + documentary + runtime + actor_score + director_score + native_english_film + february + march + april + may + june + july + august + september + october + november + december + belongs_to_collection, data=final_table)

#Model that proved to have the most statistically and practically significant variables
model_4 <- lm(log(revenue) ~ log(budget) + adventure + drama + romance + horror + foreign + runtime + actor_score + director_score + native_english_film + april + june + july + december + belongs_to_collection, data=final_table)

```



## Results

We're presenting a regression table below to compare results and find variables that prove to be significant.

```{r, results = 'asis', echo=FALSE}
stargazer(
  model_1, 
  model_2,
  model_3,
  model_4,
  type = 'latex', header = FALSE,
  column.sep.width = "1pt",
  font.size="tiny",
  no.space = TRUE
  #se = list(get_robust_se(model))
)
```


All models are overall significant when looking at F-statistic which means that our linear regression model provides a better fit to the data than a model that contains no independent variables. As we're adding more predictors into the model we want to also evaluate the Adjusted R2 since that metric will account for predictors that improve the overall model more than expected by chance. Across the model we're seeing an increase in Adjusted R2 from most simple model to the most complex, which means that independent variables are capturing the variation in the dependent variable quite well and the addition of covariates is improving the model.

We found that quite a few variables in our consideration proved to be statistically significant. Budget, our main variable in question in the first model is significant because the p-value is below 0.05 threshold and is showing practical significance with a high coefficient. Since both variables were transformed using natural logarithms we can conveniently interpret the results in percents. For every percent increase in budget will have 0.81% increase in revenue. Since this could mean that for every additional dollar in the budget the return will be 80 cents. Which is why we want to interpret additional variables to understand what is the differentiating factor between profitable and not profitable movies.

In the second model when we include genre we have to interpret the statistical significance differently to avoid getting a significant genre by chance since we're evaluating a large number of genres. To make the significance stricter we will multiply the p-value for genre by 19, since we have 19 coefficients for genre. We conclude that drama may only be significant by chance because we ran multiple t-tests. And we can say that other variables, adventure, horror and foreign genres are significant predictors of revenue.

```{r, echo=FALSE}
vcov_model_2 <- vcovHC(model_2, type='const')
table <- coeftest(model_2, vcov=vcov_model_2)[,4] 


kable(
  table,
  caption = 'Model 2 p-values', 
  col.names = c("P-value"),
  booktabs = TRUE, 
)
```

We considered evaluating the release months in the same way to make sure we're not proving a variable to be significant by chance. We'll multiply each p-value by 12 because there are 12 month variables in the model. Which leaves us with July and December as a significant variables, where June doesn't meet that level of significance and only July and Dcember are proving to be significant.

```{r, echo=FALSE}
vcov_model_3 <- vcovHC(model_3, type='const')
result_table_3 <- coeftest(model_3, vcov=vcov_model_3)[,4] 

kable(
  result_table_3,
  caption = 'Model 3 p-values', 
  col.names = c("P-value"),
  booktabs = TRUE, 
)
```


Some additional variables that proved to be a good predictor of revenue are Director Score, Actor Score and Native English Film, Belongs to Collection as well as Runtime with a caveat that runtime is not practically significant with a very low coefficients which means that there will be insignificant increase to revenue with every additional minute of runtime. On the other hand we want to pay attention to variables that are statistically significant and have a high practical significance, such as belonging to a collection of movies, having a higher budget.

Our suggested final model will be model 4 that will have practically and statistically significant variables.

## Limitations
### Statistical limitations

We will evaluate this model against 2 large model assumptions since we have a sample of well above 100. The first is IID and presence perfectly coliniear variables. 

1. In order to satisfy the large model assumption of IID, the samples used in our model must be Independent and Identically Distributed. It is difficult to guarantee that a sample is perfectly independent. Our data source originates from The Movie Database (TMDB), which is a community-built movie and TV database that includes international movies. It is one of the largest community-managed databases of movies, and provides a robust collection of movies from a range of countries. Out of this database, a sample of approximately 2000 randomly selected movies that were compiled for a Kaggle competition were used. Hence, here were no signs based on the method of data selection to suggest that the underlying distribution for samples was non-identical.

Although multiple factors could cause the movies to be dependent on each other. For example movies that are produced as part of the sequel do dependent on the revenue and success of the previous releases. There could be multiple other scenarios that can influence other movies in the sample, and we're seeing some pattern in the Residuals vs. Fitted plot below which also may indicate error terms not to follow a constant variance, but given random sample that is drawn from a large database we will consider this to satisfy the IID assumption.

```{r echo=FALSE, warning=FALSE}
modf_2 <- fortify(model_4)
ggplot(modf_2, aes(x = .fitted, y = .resid)) + geom_point() + geom_smooth(
  method = 'gam',
   formula = y ~ s(x, bs = "cs")
) + labs(
  title = "Residuals over Fitted",
  x = "Fitted",
  y = "Residuals")
```


2. The second model assumption is that there is no perfect collinearity between variables - this is suggested by the fact that none of the variables were dropped from the model when we were fitting the model. In the presence of multicollinearity, the `lm` function in R would drop a variable and not display the corresponding coefficient value or significance.

Thus, we have met the 2 large model assumptions that are necessary to support our model, and this in turn suggests that our model is reasonable for use in drawing conclusions.

### Structural Limitations

Although we've considered a multitude of variables in our model there are some limitations. For example, our actor and director scores are measured only for the all-time top 100 actors/actresses and top 50 directors as rated by an internet audience. Individuals who are only somewhat famous, are controversial, or were only popular recently may not be accurated accounted for in the data. Moreover, our results do not purport to establish an explicit cause-and-effect relationship between any features and their outcomes, as more research and analysis into the likely causal model of ticket sales would need to be performed and accounted for. While regression can be used to create predictive models, it cannot always claim to explain the reasons behind certain results.

### Omitted Variables

One structural limitations of any model are omitted variables. If there is the presence of another significant predictor that isn't measured or included in the model, this may serve to ultimately bias the results. Two of those variables that will be discussed are 1) Quality and 2) Promotional Budget or Strategy. While we will dive in-depth on these possible omitted variables of our model, it's almost certain that there are even more factors that could explain a movie's financial success or lack thereof.

#### The Quality of the Movie

So far we have discussed mostly tangible variables, such as budget, release date, cast and crew. However, we expect that these are not the only factors that can affect a movie's success.

Word of mouth has been studied as an important factor in a movie's success ^[Liu, Yong. “Word of Mouth for Movies: Its Dynamics and Impact on Box Office Revenue.” Journal of Marketing, vol. 70, no. 3, American Marketing Association, 2006, pp. 74–89, http://www.jstor.org/stable/30162102.].

Average movies tend not to create a lot of word of mouth, so they are unlikely to benefit from that effect, while excellent movies will get talked about and recommended.

We do run into a problem when trying to include it in our model. While we could use rankings and ratings as proxy variables, this research focuses on predicting a movie's revenue, and these kinds of rankings and ratings tend to come out after a movie is released, making including them in this particular model pointless.

We have decided that the best way to capture the effect of the quality of a movie would be through the Director Score variable. A movie by a great director, we hypothesize, is likely the safest bet someone can make when it comes to the movie's quality.

We would also expect some of the Quality effect to be captured by the Actors score (as we would expect famous actors to have high-quality acting skills) and budget (as we would expect films with more resources to be of higher quality.

Since we speculate that the relationship between movie quality and revenue is positive, and likewise with the Actor's score and budget, then omitting this variable may be pushing these coefficients away from zero, thus overestimating their effect on a movie's financial performance.

#### The Marketing Strategy and Budget

Another possible omitted variable is the movie's marketing. If no one hears about a movie, they are much less likely to go see it. A good marketing strategy can bring people to movie theaters and can also maximize the effect of an actor's appeal, as was the case with the previously cited Zendaya example.

Quantifying a "good" marketing strategy is complicated, but we could use the movie's marketing budget as a proxy variable. However, the marketing budget is not given as part of our dataset, as a movie's reported budget often tends to focus on just production costs.

Having said that, it's very likely that a marketing budget will be heavily correlated with a movie's production budget. So by including the budget, we are including a proxy variable for a movie's marketing strategy.

Just like with Quality, we would expect a good marketing strategy to have a positive effect on the revenue, as well as a positive effect on related variables such as the Actors Score, and thus a similar omitted variable bias.

## Conclusion and Discussion 

Considering the limitations of our study, we created a usable initial predictive model for measuring movie box office success. Using a large movie database that drew from a random sample, we focused on the variables that could be obtained before movie production and release to simulate real-world use of the model for stakeholders. We identified a significant relationship between movie revenue and multiple component features.

The first, and perhaps most obvious relationship, was found between movie budget and movie revenue. As overall spending for a film increases, the expected revenue of a film follows as well. The data also suggests that movies that are part of a sequence (i.e. not standalone releases) tend to perform well - this may also be potentially explained by the fact that films in a sequel have proven to be successful already and were provided a budget for more movies to be produced.

Moreover, seasonality of movie release appeared to be a factor in success - certain release months performed, in the aggregate, better than others. Summer proved to be a good movie season, with July producing more considerable revenues than other months in a year; the holiday season of December was also strong. Correlation does not necessarily equate to causation, however, as there may be some self-selection element with seasonality, with production companies choosing to release high budget movies during those months. 

It was also observed that native English films tended to do better whilst compared to foreign films. Movie genre might additionally be a useful predictor for movie industry decision-makers, as the horror or adventure genre often produced a stronger return on investment than others.

Lastly, the derived actor and director scores for popularity of the cast and crew have proven to be significant, with more popular actors and directors correlating with higher revenue.

If we were to continue with this research, we consider that it would be interesting to separate our dataset into time periods, as movie audiences can vary a lot throughout the years, and as mentioned before, our dataset goes back almost 100 years. In particular, a study that focuses just on the last 20 years may be more practically significant than one that uses data from all of movie history. This would require a method to categorize actors and directors from just this time period, and include that variable in our analysis. Another interesting topic to consider would be to run a regression focusing just on Opening Weekend Box Office and see how different features may compare between the two dependent variables.

We have considered the limitations of the covariates and the model and have tested some of the underlying large sample model assumptions. One limitation of our research was the omitted variable of "Quality", which is often indiscernible before the official release date of a film. While we used other variables as proxies that we hoped would capture the effect of quality, by running a future regression with Opening Weekend Box Office as the dependent variable, we surmise that the effect of movie "Quality" may be blunted somewhat. Working off of a causal model where high quality results in a larger positive feedback loop of word-of-mouth referrals, measuring solely Opening Weekend Box Office sales may help us isolate the other significant features in our future studies.

Overall, our results serve as a starting point for predictive modeling of movie-related success, and future research can be conducted to help pinpoint cause-and-effect relationships and provide even more actionable insights for film studios.



